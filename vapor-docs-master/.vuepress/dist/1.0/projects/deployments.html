<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Deployments | Laravel Vapor</title>
    <meta name="description" content="Laravel at Infinite Scale">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,800,800i,900,900i" rel="stylesheet" type="text/css">
    
    <link rel="preload" href="/assets/css/0.styles.5f56b249.css" as="style"><link rel="preload" href="/assets/js/app.04c28b41.js" as="script"><link rel="preload" href="/assets/js/9.5749b881.js" as="script"><link rel="prefetch" href="/assets/js/2.d8d0300f.js"><link rel="prefetch" href="/assets/js/3.1e4f069b.js"><link rel="prefetch" href="/assets/js/4.2a44fc6e.js"><link rel="prefetch" href="/assets/js/5.bd43df2b.js"><link rel="prefetch" href="/assets/js/6.bb590f0e.js"><link rel="prefetch" href="/assets/js/7.9f494098.js"><link rel="prefetch" href="/assets/js/8.10bf06b4.js"><link rel="prefetch" href="/assets/js/10.ba4cbb16.js"><link rel="prefetch" href="/assets/js/11.a9c00747.js"><link rel="prefetch" href="/assets/js/12.501407a6.js"><link rel="prefetch" href="/assets/js/13.b8a68b57.js"><link rel="prefetch" href="/assets/js/14.71ca6a0b.js"><link rel="prefetch" href="/assets/js/15.fe70809a.js"><link rel="prefetch" href="/assets/js/16.3dc841f8.js"><link rel="prefetch" href="/assets/js/17.fade3e51.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5f56b249.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Laravel Vapor</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://vapor.laravel.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://vapor.laravel.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>Getting Started</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/1.0/introduction.html" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/1.0/introduction.html#what-is-vapor" class="sidebar-link">What Is Vapor?</a></li><li class="sidebar-sub-header"><a href="/1.0/introduction.html#account-creation" class="sidebar-link">Account Creation</a></li><li class="sidebar-sub-header"><a href="/1.0/introduction.html#installing-the-vapor-cli" class="sidebar-link">Installing The Vapor CLI</a></li><li class="sidebar-sub-header"><a href="/1.0/introduction.html#installing-the-vapor-core" class="sidebar-link">Installing The Vapor Core</a></li><li class="sidebar-sub-header"><a href="/1.0/introduction.html#teams" class="sidebar-link">Teams</a></li><li class="sidebar-sub-header"><a href="/1.0/introduction.html#linking-with-aws" class="sidebar-link">Linking With AWS</a></li></ul></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>Projects</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/1.0/projects/the-basics.html" class="sidebar-link">The Basics</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/1.0/projects/the-basics.html#creating-projects" class="sidebar-link">Creating Projects</a></li><li class="sidebar-sub-header"><a href="/1.0/projects/the-basics.html#project-settings" class="sidebar-link">Project Settings</a></li><li class="sidebar-sub-header"><a href="/1.0/projects/the-basics.html#deleting-projects" class="sidebar-link">Deleting Projects</a></li></ul></li><li><a href="/1.0/projects/environments.html" class="sidebar-link">Environments</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/1.0/projects/environments.html#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/1.0/projects/environments.html#creating-environments" class="sidebar-link">Creating Environments</a></li><li class="sidebar-sub-header"><a href="/1.0/projects/environments.html#environment-variables" class="sidebar-link">Environment Variables</a></li><li class="sidebar-sub-header"><a href="/1.0/projects/environments.html#secrets" class="sidebar-link">Secrets</a></li><li class="sidebar-sub-header"><a href="/1.0/projects/environments.html#vanity-urls" class="sidebar-link">Vanity URLs</a></li><li class="sidebar-sub-header"><a href="/1.0/projects/environments.html#custom-domains" class="sidebar-link">Custom Domains</a></li><li class="sidebar-sub-header"><a href="/1.0/projects/environments.html#maintenance-mode" class="sidebar-link">Maintenance Mode</a></li><li class="sidebar-sub-header"><a href="/1.0/projects/environments.html#commands" class="sidebar-link">Commands</a></li><li class="sidebar-sub-header"><a href="/1.0/projects/environments.html#prewarming" class="sidebar-link">Prewarming</a></li><li class="sidebar-sub-header"><a href="/1.0/projects/environments.html#concurrency" class="sidebar-link">Concurrency</a></li><li class="sidebar-sub-header"><a href="/1.0/projects/environments.html#metrics" class="sidebar-link">Metrics</a></li><li class="sidebar-sub-header"><a href="/1.0/projects/environments.html#deleting-environments" class="sidebar-link">Deleting Environments</a></li></ul></li><li><a href="/1.0/projects/deployments.html" class="active sidebar-link">Deployments</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/1.0/projects/deployments.html#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/1.0/projects/deployments.html#initiating-deployments" class="sidebar-link">Initiating Deployments</a></li><li class="sidebar-sub-header"><a href="/1.0/projects/deployments.html#build-hooks" class="sidebar-link">Build Hooks</a></li><li class="sidebar-sub-header"><a href="/1.0/projects/deployments.html#deploy-hooks" class="sidebar-link">Deploy Hooks</a></li><li class="sidebar-sub-header"><a href="/1.0/projects/deployments.html#assets" class="sidebar-link">Assets</a></li><li class="sidebar-sub-header"><a href="/1.0/projects/deployments.html#redeploying" class="sidebar-link">Redeploying</a></li><li class="sidebar-sub-header"><a href="/1.0/projects/deployments.html#rollbacks" class="sidebar-link">Rollbacks</a></li></ul></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Resources</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/1.0/resources/queues.html" class="sidebar-link">Queues</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/1.0/resources/queues.html#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/1.0/resources/queues.html#queue-concurrency" class="sidebar-link">Queue Concurrency</a></li><li class="sidebar-sub-header"><a href="/1.0/resources/queues.html#queue-visibility-timeout" class="sidebar-link">Queue Visibility Timeout</a></li></ul></li><li><a href="/1.0/resources/storage.html" class="sidebar-link">Storage</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/1.0/resources/storage.html#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/1.0/resources/storage.html#attaching-storage" class="sidebar-link">Attaching Storage</a></li><li class="sidebar-sub-header"><a href="/1.0/resources/storage.html#file-uploads" class="sidebar-link">File Uploads</a></li></ul></li><li><a href="/1.0/resources/networks.html" class="sidebar-link">Networks</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/1.0/resources/networks.html#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/1.0/resources/networks.html#jumpboxes" class="sidebar-link">Jumpboxes</a></li><li class="sidebar-sub-header"><a href="/1.0/resources/networks.html#nat-gateways" class="sidebar-link">NAT Gateways</a></li><li class="sidebar-sub-header"><a href="/1.0/resources/networks.html#load-balancers" class="sidebar-link">Load Balancers</a></li></ul></li><li><a href="/1.0/resources/databases.html" class="sidebar-link">Databases</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/1.0/resources/databases.html#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/1.0/resources/databases.html#creating-databases" class="sidebar-link">Creating Databases</a></li><li class="sidebar-sub-header"><a href="/1.0/resources/databases.html#using-databases" class="sidebar-link">Using Databases</a></li><li class="sidebar-sub-header"><a href="/1.0/resources/databases.html#database-users" class="sidebar-link">Database Users</a></li><li class="sidebar-sub-header"><a href="/1.0/resources/databases.html#scaling-databases" class="sidebar-link">Scaling Databases</a></li><li class="sidebar-sub-header"><a href="/1.0/resources/databases.html#restoring-databases" class="sidebar-link">Restoring Databases</a></li><li class="sidebar-sub-header"><a href="/1.0/resources/databases.html#metrics" class="sidebar-link">Metrics</a></li><li class="sidebar-sub-header"><a href="/1.0/resources/databases.html#deleting-databases" class="sidebar-link">Deleting Databases</a></li></ul></li><li><a href="/1.0/resources/caches.html" class="sidebar-link">Caches</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/1.0/resources/caches.html#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/1.0/resources/caches.html#creating-caches" class="sidebar-link">Creating Caches</a></li><li class="sidebar-sub-header"><a href="/1.0/resources/caches.html#using-caches" class="sidebar-link">Using Caches</a></li><li class="sidebar-sub-header"><a href="/1.0/resources/caches.html#scaling-caches" class="sidebar-link">Scaling Caches</a></li><li class="sidebar-sub-header"><a href="/1.0/resources/caches.html#metrics" class="sidebar-link">Metrics</a></li><li class="sidebar-sub-header"><a href="/1.0/resources/caches.html#dynamodb-caches" class="sidebar-link">DynamoDB Caches</a></li><li class="sidebar-sub-header"><a href="/1.0/resources/caches.html#deleting-caches" class="sidebar-link">Deleting Caches</a></li></ul></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Domains</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/1.0/domains/registrar.html" class="sidebar-link">Registrar</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/1.0/domains/registrar.html#introduction" class="sidebar-link">Introduction</a></li></ul></li><li><a href="/1.0/domains/dns.html" class="sidebar-link">DNS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/1.0/domains/dns.html#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/1.0/domains/dns.html#creating-dns-zones" class="sidebar-link">Creating DNS Zones</a></li><li class="sidebar-sub-header"><a href="/1.0/domains/dns.html#nameservers" class="sidebar-link">Nameservers</a></li><li class="sidebar-sub-header"><a href="/1.0/domains/dns.html#managing-dns-records" class="sidebar-link">Managing DNS Records</a></li><li class="sidebar-sub-header"><a href="/1.0/domains/dns.html#deleting-zones" class="sidebar-link">Deleting Zones</a></li></ul></li><li><a href="/1.0/domains/certificates.html" class="sidebar-link">Certificates</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/1.0/domains/certificates.html#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/1.0/domains/certificates.html#creating-certificates" class="sidebar-link">Creating Certificates</a></li><li class="sidebar-sub-header"><a href="/1.0/domains/certificates.html#deleting-certificates" class="sidebar-link">Deleting Certificates</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="deployments"><a href="#deployments" aria-hidden="true" class="header-anchor">#</a> Deployments</h1> <p></p><div class="table-of-contents"><ul><li><a href="#introduction">Introduction</a></li><li><a href="#initiating-deployments">Initiating Deployments</a></li><li><a href="#build-hooks">Build Hooks</a></li><li><a href="#deploy-hooks">Deploy Hooks</a></li><li><a href="#assets">Assets</a><ul><li><a href="#urls-within-css">URLs Within CSS</a></li></ul></li><li><a href="#redeploying">Redeploying</a></li><li><a href="#rollbacks">Rollbacks</a></li></ul></div><p></p> <h2 id="introduction"><a href="#introduction" aria-hidden="true" class="header-anchor">#</a> Introduction</h2> <p>Of course, one of the primary features of Laravel Vapor are atomic, zero-downtime deployments. Unlike many other features of Vapor, deployments are <strong>only initiated via the Vapor CLI</strong>. During deployment, Vapor will run the <code>build</code> steps of your <code>vapor.yml</code> file on the local machine that the deployment is running on. This might be your personal machine or a continuous integration platform.</p> <h2 id="initiating-deployments"><a href="#initiating-deployments" aria-hidden="true" class="header-anchor">#</a> Initiating Deployments</h2> <p>To initiate a deployment, execute the <code>deploy</code> CLI command from the root of your application:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>vapor deploy production
</code></pre></div><h2 id="build-hooks"><a href="#build-hooks" aria-hidden="true" class="header-anchor">#</a> Build Hooks</h2> <p>You may define build hooks for an environment using the <code>build</code> key within your <code>vapor.yml</code> file. These commands are executed on the local machine that the deployment is running on and may be used to prepare your application for deployment. During deployment, your application is built within a temporary <code>.vapor</code> directory that is created by the CLI and all of your <code>build</code> commands will run within that temporary directory:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">id</span><span class="token punctuation">:</span> <span class="token number">3</span>
<span class="token key atrule">name</span><span class="token punctuation">:</span> vapor<span class="token punctuation">-</span>app
<span class="token key atrule">environments</span><span class="token punctuation">:</span>
    <span class="token key atrule">production</span><span class="token punctuation">:</span>
        <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token number">1024</span>
        <span class="token key atrule">database</span><span class="token punctuation">:</span> vapor<span class="token punctuation">-</span>app
        <span class="token key atrule">cache</span><span class="token punctuation">:</span> vapor<span class="token punctuation">-</span>cache
        <span class="token key atrule">build</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token string">'composer install --no-dev --classmap-authoritative'</span>
            <span class="token punctuation">-</span> <span class="token string">'php artisan event:cache'</span>
        <span class="token key atrule">deploy</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token string">'php artisan migrate --force'</span>
</code></pre></div><h2 id="deploy-hooks"><a href="#deploy-hooks" aria-hidden="true" class="header-anchor">#</a> Deploy Hooks</h2> <p>You may define deployment hooks for an environment using the <code>deploy</code> key within your <code>vapor.yml</code> file. These commands are executed against the deployed environment <strong>before it is activated for general availability</strong>. If any of these commands fail, the deployment will not be activated. You may review the output / logs from your deployment hooks via the Vapor UI's deployment detail screen:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">id</span><span class="token punctuation">:</span> <span class="token number">3</span>
<span class="token key atrule">name</span><span class="token punctuation">:</span> vapor<span class="token punctuation">-</span>app
<span class="token key atrule">environments</span><span class="token punctuation">:</span>
    <span class="token key atrule">production</span><span class="token punctuation">:</span>
        <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token number">1024</span>
        <span class="token key atrule">database</span><span class="token punctuation">:</span> vapor<span class="token punctuation">-</span>app
        <span class="token key atrule">cache</span><span class="token punctuation">:</span> vapor<span class="token punctuation">-</span>cache
        <span class="token key atrule">build</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token string">'composer install --no-dev --classmap-authoritative'</span>
            <span class="token punctuation">-</span> <span class="token string">'php artisan event:cache'</span>
        <span class="token key atrule">deploy</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token string">'php artisan migrate --force'</span>
</code></pre></div><h2 id="assets"><a href="#assets" aria-hidden="true" class="header-anchor">#</a> Assets</h2> <p>During deployment, Vapor will automatically extract all of the assets in your Laravel project's <code>public</code> directory and upload them to S3. In addition, Vapor will create a AWS CloudFront (CDN) distribution to distribute these assets efficiently around the world.</p> <p>Because all of your assets will be served via S3 / CloudFront, you should always generate URLs to these assets using Laravel's <code>asset</code> helper. Vapor injects an <code>ASSET_URL</code> environment variable which Laravel's <code>asset</code> helper will use when constructing your URLs:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token double-quoted-string string">&quot;{{ asset('img.jpg') }}&quot;</span><span class="token operator">&gt;</span>
</code></pre></div><p>On subsequent deployments, only the assets that have changed will be uploaded to S3, while unchanged assets will be copied over from the previous deployment.</p> <h3 id="urls-within-css"><a href="#urls-within-css" aria-hidden="true" class="header-anchor">#</a> URLs Within CSS</h3> <p>Sometimes, your CSS may need to reference asset URLs, such as a <code>background-image</code> property that references an image via URL. Obviously, you are not able to use the PHP <code>asset</code> helper within your CSS. For this reason, Vapor will automatically prepend the correct asset base URL to all relative URLs in your CSS during the build process. After your build steps have executed, Vapor performs this action against any CSS files in your application's <code>public</code> directory (including directories nested under <code>public</code>).</p> <h2 id="redeploying"><a href="#redeploying" aria-hidden="true" class="header-anchor">#</a> Redeploying</h2> <p>Sometimes you may need to simply redeploy a given environment without rebuilding or redeploying it. For example, you may wish to do this after updating an environment variable. To accomplish this, you may use the Vapor UI or the <code>redeploy</code> CLI command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>vapor redeploy production
</code></pre></div><h2 id="rollbacks"><a href="#rollbacks" aria-hidden="true" class="header-anchor">#</a> Rollbacks</h2> <p>To rollback to a previous deployment, you may select the deployment in the Vapor UI and click the &quot;Rollback To&quot; button, or you may use the <code>rollback</code> CLI command. The <code>rollback</code> command's &quot;--select&quot; option will allow you to select which deployment to rollback to from a list of recent deployments. If the <code>rollback</code> command is executed without this option, it will simply rollback to the most previous successful deployment:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>vapor rollback production

vapor rollback production --select
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">Variables, Secrets, &amp; Rollbacks</p> <p>When rolling back to a previous deployment, Vapor will use the environment's variables and secrets as they existed at the time the deployment you're rolling back to was originally deployed.</p></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/1.0/projects/environments.html" class="prev">
          Environments
        </a></span> <span class="next"><a href="/1.0/resources/queues.html">
          Queues
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/9.5749b881.js" defer></script><script src="/assets/js/app.04c28b41.js" defer></script>
  </body>
</html>
